#!/usr/bin/env node


const glob       = require( 'glob' );
const replaceExt = require( 'replace-ext' );
const fs         = require( 'fs' );
const compiler   = require( 'nanogl-template/lib/compiler' );

const globPattern = 'src/glsl/**/*.+(vert|frag|glsl)';


function compile( path ){
  // console.log( path )
  var jsPath = path+'.js';//replaceExt( path, '.js' );
  jsPath = jsPath.replace( 'src/', 'dist/' );

  var src = fs.readFile( path, {encoding:'utf-8'}, function(e, data){
    if( e ){ return };
    var js = compiler( data, {module:'esm'} );
    fs.writeFile( jsPath, js, {encoding:'utf-8'}, function( e ){
      //done
      //  console.log( e, jsPath )
    })
  });
}


glob( globPattern, function (er, files) {
  files.forEach( compile )
})